# Galahad Testing Infrastructure

The galahad testing process consists of deploying the galahad system using the `deploy.py` script in the `deploy` directory.
After the deployment process is complete the tests can be initiated using the `test.py` script. 
`pytest` is used as the testing framework.
Currently galahad supports two types of tests:
   - unit
        - These are unit tests that test components locally and use internal API calls to test the components.
          These tests do not use any REST calls.
   - integration
        - These are integration tests that test the system functionality and rely on REST calls to test the galahad components.

The tests are all run on the `excalibur` node and the results are transferred to the local directory from where the tests were initiated.
A `html` and `xml` file contain the final results of the tests.

## test.py
`test.py` can be run from the users desktop and will do the following:
   - log into the deployment node of the specified stack using its public IP
   - run the appropriate test file - `unit.py` or `integration.py` to run the specified tests
   - transfer the results report files (`html` and `xml`) generated by `pytest` from excalibur node to the local desktop.

Usage:
```
usage: test.py [-h] [-n STACK_NAME] -i SSHKEY -t TEST_TYPE [-v VIRTUE_IP]
               [-d VIRTUE_ID] [--run_test RUN_TEST] [--list_tests]
               [--run_all_tests]

optional arguments:
  -h, --help            show this help message and exit
  -n STACK_NAME, --stack_name STACK_NAME
                        Name of galahad stack to run the tests against
  -i SSHKEY, --sshkey SSHKEY
                        The path to the private key to use ssh with
  -t TEST_TYPE, --test_type TEST_TYPE
                        The type of Test to run - integration or unit
  -v VIRTUE_IP, --virtue_ip VIRTUE_IP
                        The IP address of an existing aws Virtue instance.
  -d VIRTUE_ID, --virtue_id VIRTUE_ID
                        The Virtue ID of an existing aws Virtue instance.
  --run_test RUN_TEST   The Integration/Unit Test that will be run
  --list_tests          List All available Integration/Unit Tests
  --run_all_tests       Run All available Integration/Unit Tests
```
Example: (To run the specific test `test_valor_migrate_virtue` from the `test_valor` test package)
```
python test.py
       -i ../../starlab-virtue-te.pem
       -n APL1
       -t integration
       --run_test 'test_valor.py::Test_ValorAPI::test_valor_migrate_virtue'
```
## unit.py
`unit.py` needs to be run from the deployment node or the excalibur node and will run the appropriate unit tests
and return the results in a `html` and `xml` file generated by the `pytest` test framework.

Usage:
```
usage: unit.py [-h] -i SSHKEY [--run_test RUN_TEST] [--list_tests]
               [--run_all_tests]

optional arguments:
  -h, --help            show this help message and exit
  -i SSHKEY, --sshkey SSHKEY
                        The path to the private key to use ssh with
  --run_test RUN_TEST   The specified Unit Test that will be run
  --list_tests          List All available Unit Tests
  --run_all_tests       Run All available unit Tests
```

## integration.py
`integration.py` needs to be run from the deployment node or the excalibur node and will run the appropriate integration tests
and return the results in a `html` and `xml` file generated by the `pytest` test framework.

Usage:
```
usage: integration.py [-h] -i SSHKEY [-v VIRTUE_IP] [-d VIRTUE_ID]
                      [--run_test RUN_TEST] [--list_tests] [--run_all_tests]

optional arguments:
  -h, --help            show this help message and exit
  -i SSHKEY, --sshkey SSHKEY
                        The path to the private key to use ssh with
  -v VIRTUE_IP, --virtue_ip VIRTUE_IP
                        The IP address of an existing aws Virtue instance.
  -d VIRTUE_ID, --virtue_id VIRTUE_ID
                        The Virtue ID of an existing aws Virtue instance.
  --run_test RUN_TEST   The specified Integration Test that will be run
  --list_tests          List All available Integration Tests
  --run_all_tests       Run All available Integration Tests
```
